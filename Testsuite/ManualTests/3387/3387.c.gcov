        -:    0:Source:3387.c
        -:    0:Graph:3387.gcno
        -:    0:Data:3387.gcda
        -:    0:Runs:1
        -:    1:/* PR regression/21897 */
        -:    2:/* This testcase generates MMX instructions together with x87 instructions.
        -:    3:   Currently, there is no "emms" generated to switch between register sets,
        -:    4:   so the testcase fails for targets where MMX insns are enabled.  */
        -:    5:/* { dg-options "-mno-mmx" { target { x86_64-*-* i?86-*-* } } } */
        -:    6:
        -:    7:extern void abort(void);
        -:    8:
        -:    9:typedef unsigned short v4hi __attribute__((vector_size(8)));
        -:   10:typedef float v4sf __attribute__((vector_size(16)));
        -:   11:
        -:   12:union {
        -:   13:  v4hi v;
        -:   14:  short s[4];
        -:   15:} u;
        -:   16:
        -:   17:union {
        -:   18:  v4sf v;
        -:   19:  float f[4];
        -:   20:} v;
        -:   21:
        1:   22:void foo(void) {
        -:   23:  unsigned int i;
        3:   24:  for (i = 0; i < 2; i++)
        2:   25:    u.v += (v4hi){12, 32768};
        3:   26:  for (i = 0; i < 2; i++)
        2:   27:    v.v += (v4sf){18.0, 20.0, 22};
        1:   28:}
        -:   29:
        1:   30:int main(void) {
        1:   31:  foo();
        1:   32:  if (u.s[0] != 24 || u.s[1] != 0 || u.s[2] || u.s[3])
    #####:   33:    abort();
        1:   34:  if (v.f[0] != 36.0 || v.f[1] != 40.0 || v.f[2] != 44.0 || v.f[3] != 0.0)
    #####:   35:    abort();
        1:   36:  return 0;
        -:   37:}
