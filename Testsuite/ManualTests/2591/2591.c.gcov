        -:    0:Source:2591.c
        -:    0:Graph:2591.gcno
        -:    0:Data:2591.gcda
        -:    0:Runs:1
        -:    1:/* Test whether using target specific options, we can generate popcnt by
        -:    2:   setting the architecture.  */
        -:    3:/* { dg-do compile } */
        -:    4:/* { dg-require-effective-target lp64 } */
        -:    5:/* { dg-skip-if "" { *-*-* } { "-march=*" } { "-march=k8" } } */
        -:    6:/* { dg-options "-O2 -march=k8 -mno-sse3" } */
        -:    7:
        -:    8:extern void exit(int);
        -:    9:extern void abort(void);
        -:   10:
        -:   11:#define SSE4A_ATTR __attribute__((__target__("arch=amdfam10")))
        -:   12:#define SSE42_ATTR __attribute__((__target__("sse4.2")))
        -:   13:
        -:   14:static int sse4a_pop_i(int a) SSE4A_ATTR;
        -:   15:static long sse42_pop_l(long a) SSE42_ATTR;
        -:   16:static int generic_pop_i(int a);
        -:   17:static long generic_pop_l(long a);
        -:   18:
        1:   19:static int sse4a_pop_i(int a) { return __builtin_popcount(a); }
        -:   20:
        1:   21:static long sse42_pop_l(long a) { return __builtin_popcountl(a); }
        -:   22:
        1:   23:static int generic_pop_i(int a) { return __builtin_popcount(a); }
        -:   24:
        1:   25:static long generic_pop_l(long a) { return __builtin_popcountl(a); }
        -:   26:
        -:   27:int five = 5;
        -:   28:long seven = 7;
        -:   29:
        1:   30:int main() {
        1:   31:  if (sse4a_pop_i(five) != 2)
    #####:   32:    abort();
        -:   33:
        1:   34:  if (sse42_pop_l(seven) != 3L)
    #####:   35:    abort();
        -:   36:
        1:   37:  if (generic_pop_i(five) != 2)
    #####:   38:    abort();
        -:   39:
        1:   40:  if (generic_pop_l(seven) != 3L)
    #####:   41:    abort();
        -:   42:
        1:   43:  exit(0);
        -:   44:}
        -:   45:
        -:   46:/* { dg-final { scan-assembler "popcntl" { target { ! *-*-darwin* } } } } */
        -:   47:/* { dg-final { scan-assembler "popcntq" { target { ! *-*-darwin* } } } } */
        -:   48:/* { dg-final { scan-assembler-times "popcnt" 2 { target *-*-darwin* } } } */
        -:   49:/* { dg-final { scan-assembler "call\t(.*)sse4a_pop_i" } } */
        -:   50:/* { dg-final { scan-assembler "call\t(.*)sse42_pop_l" } } */
        -:   51:/* { dg-final { scan-assembler "call\t(.*)popcountdi2" } } */
